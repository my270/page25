<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üìä Diagramme des exigences - IA pour Radiographies</title>
    <!-- Inclusion de html2pdf.js pour la g√©n√©ration de PDF c√¥t√© client -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.2/html2pdf.bundle.min.js"></script>
    <style>
        :root {
            --primary-color: #2E8B57;
            --secondary-color: #F0F8FF;
            --accent-color: #FF8C00;
            --text-color: #333;
            --box-bg: #FFFFFF;
            --shadow: rgba(0, 0, 0, 0.1);
            --correct-color: #4CAF50;
            --partial-color: #FFC107;
            --incorrect-color: #F44336;
            --table-border: #ccc;
        }
        * { box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--secondary-color);
            color: var(--text-color);
            margin: 0; padding: 20px;
            display: flex; justify-content: center;
        }
        .container {
            max-width: 900px; width: 100%; background: var(--box-bg);
            padding: 30px; border-radius: 12px;
            box-shadow: 0 4px 12px var(--shadow);
        }
        .header { text-align: center; margin-bottom: 30px; }
        .header h1 { margin: 0; font-size: 2.5rem; color: var(--primary-color); }
        .student-info, .buttons { display: flex; gap: 20px; margin-bottom: 30px; }
        .student-info label { display: flex; align-items: center; font-weight: bold; width: 120px; }
        .student-info input { flex: 1; padding: 8px; border: 1px solid #ccc; border-radius: 6px; }
        .intro { background-color: var(--primary-color); color: #fff; padding: 20px; border-radius: 8px; margin-bottom: 25px; }
        .intro h2 { margin-top: 0; font-size: 1.8rem; }
        .intro p { line-height: 1.5; }

        /* Tableau comparatif */
        .comparison-table {
            width: 100%;
            border-collapse: collapse;
            margin: 25px 0;
            background-color: #f9f9f9;
        }
        .comparison-table th, .comparison-table td {
            border: 1px solid var(--table-border);
            padding: 12px;
        }
        .comparison-table th {
            background-color: var(--primary-color);
            color: white;
            text-align: center;
        }
        .comparison-table tr:nth-child(even) {
            background-color: #f2f2f2;
        }

        /* Diagramme des exigences */
        .exigences-diagram {
            border: 1px solid #ccc;
            padding: 20px;
            margin: 25px 0;
            background-color: #f5f5f5;
        }
        .project-header {
            margin-bottom: 20px;
        }
        .exigence-principale {
            margin-bottom: 20px;
        }
        .project-header input, .exigence-principale input {
            width: 100%;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 6px;
        }
        .exigences-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
        }
        .exigence-box {
            border: 1px solid #ccc;
            padding: 10px;
            background-color: white;
            position: relative;
        }
        .exigence-box h4 {
            margin-top: 0;
            text-align: center;
            background-color: #eee;
            padding: 5px;
            margin-bottom: 10px;
        }
        .exigence-box textarea {
            width: 100%;
            min-height: 100px;
            resize: vertical;
            padding: 8px;
            border: 1px solid #ddd;
        }
        .contrainte-box {
            margin-top: 10px;
        }
        .contrainte-box h5 {
            margin: 5px 0;
            text-align: center;
            font-size: 0.9rem;
        }

        .explanation { font-style: italic; margin: 15px 0; }
        .correction-feedback {
            display: none;
            margin-top: 10px;
            padding: 8px;
            border-radius: 4px;
            font-style: italic;
        }
        .correct {
            border: 2px solid var(--correct-color);
            background-color: rgba(76, 175, 80, 0.1);
        }
        .partially-correct {
            border: 2px solid var(--partial-color);
            background-color: rgba(255, 193, 7, 0.1);
        }
        .incorrect {
            border: 2px solid var(--incorrect-color);
            background-color: rgba(244, 67, 54, 0.1);
        }
        .results-panel {
            display: none;
            margin: 20px 0;
            padding: 15px;
            background-color: #e9f5f9;
            border-radius: 8px;
            text-align: center;
        }
        .results-panel h2 {
            color: var(--primary-color);
            margin-top: 0;
        }
        .score {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--primary-color);
        }
        .points {
            position: absolute;
            top: 5px;
            right: 10px;
            font-weight: bold;
            padding: 3px 8px;
            border-radius: 50%;
            display: none;
        }
        .good-point {
            background-color: var(--correct-color);
            color: white;
        }
        .neutral-point {
            background-color: var(--partial-color);
            color: black;
        }
        .bad-point {
            background-color: var(--incorrect-color);
            color: white;
        }
        .note-provisoire {
            margin-top: 10px;
            font-style: italic;
            text-align: center;
            color: #555;
            font-weight: bold;
        }
        .buttons { justify-content: center; }
        button { 
            padding: 12px 24px; 
            background-color: var(--accent-color); 
            color: #fff; 
            border: none; 
            border-radius: 8px; 
            cursor: pointer; 
            font-size: 1rem; 
            transition: background 0.3s; 
        }
        button:hover { background-color: #e67600; }
        .conclusion { 
            margin-top: 30px; 
            font-style: italic; 
            text-align: center; 
        }
    </style>
</head>
<body>
    <div class="container" id="rapport">
        <div class="header">
            <h1>üìä Diagramme des exigences - IA pour Radiographies</h1>
        </div>
        <div class="student-info">
            <label for="nom">üìù Nom:</label>
            <input type="text" id="nom" name="nom">
            <label for="prenom">üë§ Pr√©nom:</label>
            <input type="text" id="prenom" name="prenom">
        </div>
        <div class="intro">
            <h2>üéØ Outils d'un projet technique</h2>
            <p>Lorsqu'on r√©alise un projet, il est important de bien organiser ses id√©es et de d√©finir <strong>ce qu'on veut obtenir</strong>. Pour cela, on utilise diff√©rents outils dont :</p>
            <ul>
                <li><strong>Le cahier des charges</strong>, qui est un document √©crit d√©crivant tout ce que le projet doit respecter (besoins, contraintes, objectifs).</li>
                <li><strong>Le diagramme des exigences</strong>, qui est un sch√©ma visuel permettant de mieux comprendre et structurer ces exigences.</li>
            </ul>
            <p>Ces outils sont tr√®s utiles car ils permettent de :</p>
            <ul>
                <li><strong>Clarifier les attentes</strong> d√®s le d√©but du projet</li>
                <li><strong>√âviter les erreurs</strong> en d√©finissant pr√©cis√©ment les objectifs</li>
                <li><strong>Communiquer facilement</strong> avec toutes les personnes impliqu√©es</li>
                <li><strong>Mieux organiser le travail</strong> en reliant chaque exigence aux besoins du projet</li>
            </ul>
        </div>

        <!-- Tableau comparatif -->
        <h3>Comparaison entre Cahier des charges et Diagramme des exigences</h3>
        <table class="comparison-table">
            <thead>
                <tr>
                    <th>Crit√®re</th>
                    <th>Cahier des charges</th>
                    <th>Diagramme des exigences</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td><strong>Qu'est-ce que c'est ?</strong></td>
                    <td>Un document qui explique tout ce qu'on attend du projet.</td>
                    <td>Un sch√©ma qui montre les exigences et leurs liens.</td>
                </tr>
                <tr>
                    <td><strong>Comment √ßa se pr√©sente ?</strong></td>
                    <td>Un texte avec des descriptions et des r√®gles pr√©cises.</td>
                    <td>Un dessin avec des cases reli√©es entre elles.</td>
                </tr>
                <tr>
                    <td><strong>√Ä quoi √ßa sert ?</strong></td>
                    <td>D√©finir clairement ce qu'il faut faire et comment le faire.</td>
                    <td>Organiser et comprendre les besoins du projet de mani√®re visuelle.</td>
                </tr>
                <tr>
                    <td><strong>Exemple : syst√®me de tri des d√©chets avec IA</strong></td>
                    <td>Le syst√®me doit reconna√Ætre les mat√©riaux (plastique, verre, m√©tal), √™tre rapide et pr√©cis, et fonctionner avec une cam√©ra.</td>
                    <td>Un sch√©ma avec les exigences : "Reconna√Ætre plastique", "Reconna√Ætre verre", "Rapide", "Pr√©cis", "Cam√©ra", toutes reli√©es au projet.</td>
                </tr>
            </tbody>
        </table>

        <!-- Diagramme des exigences -->
        <h3>Votre diagramme des exigences - IA pour l'analyse de radiographies</h3>
        <div class="exigences-diagram">
            <div class="project-header">
                <label for="project-name"><strong>Nom du projet :</strong></label>
                <input type="text" id="project-name">
                <div class="correction-feedback" id="feedback-project-name"></div>
                <div class="points" id="points-project-name"></div>
            </div>
            
            <div class="exigence-principale">
                <label for="exigence-principale"><strong>Exigence principale :</strong></label>
                <input type="text" id="exigence-principale">
                <div class="correction-feedback" id="feedback-exigence-principale"></div>
                <div class="points" id="points-exigence-principale"></div>
            </div>
            
            <h4>Exigences secondaires</h4>
            <div class="exigences-grid">
                <!-- Capture image -->
                <div class="exigence-box">
                    <h4>Capture image</h4>
                    <textarea id="capture-image"></textarea>
                    <div class="correction-feedback" id="feedback-capture-image"></div>
                    <div class="points" id="points-capture-image"></div>
                    <div class="contrainte-box">
                        <h5>R√©solution</h5>
                        <textarea id="contrainte-resolution"></textarea>
                        <div class="correction-feedback" id="feedback-contrainte-resolution"></div>
                        <div class="points" id="points-contrainte-resolution"></div>
                    </div>
                </div>
                
                <!-- IA -->
                <div class="exigence-box">
                    <h4>IA</h4>
                    <textarea id="ia"></textarea>
                    <div class="correction-feedback" id="feedback-ia"></div>
                    <div class="points" id="points-ia"></div>
                    <div class="contrainte-box">
                        <h5>Taux de reconnaissance</h5>
                        <textarea id="contrainte-taux"></textarea>
                        <div class="correction-feedback" id="feedback-contrainte-taux"></div>
                        <div class="points" id="points-contrainte-taux"></div>
                    </div>
                </div>
                
                <!-- Affichage -->
                <div class="exigence-box">
                    <h4>Affichage</h4>
                    <textarea id="affichage"></textarea>
                    <div class="correction-feedback" id="feedback-affichage"></div>
                    <div class="points" id="points-affichage"></div>
                    <div class="contrainte-box">
                        <h5>Temps de r√©ponse</h5>
                        <textarea id="contrainte-temps"></textarea>
                        <div class="correction-feedback" id="feedback-contrainte-temps"></div>
                        <div class="points" id="points-contrainte-temps"></div>
                    </div>
                </div>
                
                <!-- S√©curit√© / Fiabilit√© -->
                <div class="exigence-box">
                    <h4>S√©curit√© / Fiabilit√©</h4>
                    <textarea id="securite"></textarea>
                    <div class="correction-feedback" id="feedback-securite"></div>
                    <div class="points" id="points-securite"></div>
                    <div class="contrainte-box">
                        <h5>Utilisation</h5>
                        <textarea id="contrainte-utilisation"></textarea>
                        <div class="correction-feedback" id="feedback-contrainte-utilisation"></div>
                        <div class="points" id="points-contrainte-utilisation"></div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="results-panel" id="results-panel">
            <h2>R√©sultats</h2>
            <p>Vous avez obtenu <span class="score" id="score">0</span> points sur 10.</p>
            <p id="feedback-message"></p>
            <p class="note-provisoire">‚ö†Ô∏è Note provisoire qui sera ajust√©e manuellement lors de la correction finale.</p>
        </div>
        
        <div class="buttons">
            <button id="finish-btn" onclick="checkAnswers()">‚úÖ J'ai fini</button>
            <button onclick="generatePDF()">üìÑ Convertir en PDF et d√©poser dans Pearltrees</button>
        </div>
        
        <div class="conclusion">
            <p>üí° Le diagramme des exigences est un outil essentiel pour visualiser et organiser toutes les sp√©cifications d'un projet technique avant sa r√©alisation.</p>
        </div>
    </div>
    <script>
        // D√©finition des r√©ponses correctes bas√©es sur l'image de correction fournie
        const correctAnswers = {
            "project-name": "Syst√®me d'IA pour l'analyse des radiographies m√©dicales",
            "exigence-principale": "Analyser automatiquement les radiographies pour d√©tecter les anomalies et aider au diagnostic m√©dical",
            "capture-image": "Prendre une image claire et d√©taill√©e des radiographies",
            "ia": "Identifier les anomalies et fractures pr√©sentes",
            "affichage": "Indiquer les zones suspectes sur la radiographie et fournir un rapport d'analyse",
            "securite": "Fonctionner de mani√®re pr√©cise et √©viter les erreurs critiques",
            "contrainte-resolution": "Bonne r√©solution des images pour une analyse pr√©cise",
            "contrainte-taux": "Fiabilit√© minimale de 95% dans la d√©tection des anomalies",
            "contrainte-temps": "Moins de 2 s",
            "contrainte-utilisation": "Facilement interpr√©table par les professionnels de sant√©"
        };
        
        // Fonction pour v√©rifier les r√©ponses et attribuer des points
        function checkAnswers() {
            // Emp√™cher de cliquer √† nouveau
            document.getElementById('finish-btn').disabled = true;
            
            let totalPoints = 0;
            const fields = [
                "project-name", "exigence-principale", 
                "capture-image", "ia", "affichage", "securite",
                "contrainte-resolution", "contrainte-taux", "contrainte-temps", "contrainte-utilisation"
            ];
            
            fields.forEach(field => {
                const userAnswer = document.getElementById(field).value.trim();
                const correctAnswer = correctAnswers[field];
                const feedbackElement = document.getElementById(`feedback-${field}`);
                const pointsElement = document.getElementById(`points-${field}`);
                
                // Initialiser les variables
                let points = 0;
                let feedbackText = "";
                let className = "";
                
                // Si pas de r√©ponse, c'est automatiquement 0 point
                if (userAnswer === "") {
                    points = 0;
                    feedbackText = "Aucune r√©ponse. La r√©ponse attendue √©tait: " + correctAnswers[field];
                    className = "incorrect";
                    pointsElement.className = "points bad-point";
                } 
                // Si la r√©ponse est remplie, v√©rifier sa similarit√© avec la correction
                else {
                    // Convertir en minuscules pour la comparaison
                    const userAnswerLower = userAnswer.toLowerCase();
                    const correctAnswerLower = correctAnswer.toLowerCase();
                    
                    // V√©rifier la ressemblance entre la r√©ponse de l'√©l√®ve et la r√©ponse correcte
                    if (userAnswerLower === correctAnswerLower) {
                        // R√©ponse parfaitement exacte
                        points = field.includes("principale") ? 2 : 1; // 2 points pour exigence principale, 1 pour le reste
                        feedbackText = "Parfait! " + correctAnswer;
                        className = "correct";
                        pointsElement.className = "points good-point";
                    } 
                    // V√©rifier si la r√©ponse est partiellement correcte
                    else if (correctAnswerLower.includes(userAnswerLower) || 
                             userAnswerLower.includes(correctAnswerLower.substring(0, Math.floor(correctAnswerLower.length / 2))) ||
                             similarityScore(userAnswerLower, correctAnswerLower) > 0.6) {
                        // R√©ponse partiellement correcte
                        points = field.includes("principale") ? 1 : 0.5;
                        feedbackText = "Partiellement correct. La r√©ponse attendue √©tait: " + correctAnswer;
                        className = "partially-correct";
                        pointsElement.className = "points neutral-point";
                    } 
                    // Sinon, r√©ponse incorrecte
                    else {
                        points = 0;
                        feedbackText = "Incorrect. La r√©ponse attendue √©tait: " + correctAnswer;
                        className = "incorrect";
                        pointsElement.className = "points bad-point";
                    }
                }
                
                // Appliquer le feedback
                document.getElementById(field).classList.add(className);
                feedbackElement.textContent = feedbackText;
                feedbackElement.classList.add(className);
                feedbackElement.style.display = "block";
                
                // Afficher les points
                pointsElement.textContent = points;
                pointsElement.style.display = "block";
                
                // Ajouter au total
                totalPoints += points;
            });
            
            // Arrondir le total √† un nombre entier
            totalPoints = Math.round(totalPoints);
            
            // Afficher le score total
            document.getElementById('score').textContent = totalPoints;
            
            // Ajouter un feedback g√©n√©ral
            let feedbackMessage = "";
            if (totalPoints >= 8) {
                feedbackMessage = "Excellent travail! Vous avez bien compris le concept du diagramme des exigences.";
            } else if (totalPoints >= 5) {
                feedbackMessage = "Bon travail. Continuez √† vous am√©liorer!";
            } else {
                feedbackMessage = "Revoyez les concepts du diagramme des exigences pour mieux comprendre.";
            }
            document.getElementById('feedback-message').textContent = feedbackMessage;
            
            // Afficher le panneau de r√©sultats
            document.getElementById('results-panel').style.display = "block";
            document.getElementById('results-panel').scrollIntoView({behavior: 'smooth'});
        }
        
        // Fonction pour calculer la similarit√© entre deux cha√Ænes de caract√®res
        function similarityScore(str1, str2) {
            // Calculer la distance de Levenshtein
            const len1 = str1.length;
            const len2 = str2.length;
            const matrix = Array(len1 + 1).fill().map(() => Array(len2 + 1).fill(0));
            
            for (let i = 0; i <= len1; i++) {
                matrix[i][0] = i;
            }
            
            for (let j = 0; j <= len2; j++) {
                matrix[0][j] = j;
            }
            
            for (let i = 1; i <= len1; i++) {
                for (let j = 1; j <= len2; j++) {
                    const cost = str1[i - 1] !== str2[j - 1] ? 1 : 0;
                    matrix[i][j] = Math.min(
                        matrix[i - 1][j] + 1,      // deletion
                        matrix[i][j - 1] + 1,      // insertion
                        matrix[i - 1][j - 1] + cost // substitution
                    );
                }
            }
            
            // Calculer la similarit√© (1 - distance normalis√©e)
            const maxLen = Math.max(len1, len2);
            return maxLen > 0 ? 1 - matrix[len1][len2] / maxLen : 1;
        }
        
        function generatePDF() {
            const nom = document.getElementById('nom').value.trim();
            const prenom = document.getElementById('prenom').value.trim();
            if (!nom || !prenom) {
                alert('Veuillez remplir votre nom et pr√©nom avant de g√©n√©rer le PDF.');
                return;
            }
            
            // Pr√©parer le document pour l'impression PDF
            const elementsToHideForPDF = document.querySelectorAll('.buttons');
            elementsToHideForPDF.forEach(el => el.style.display = 'none');
            
            // G√©n√©rer le PDF
            const filename = `${prenom}_${nom}_diagramme_exigences.pdf`;
            html2pdf()
                .set({
                    margin: 10,
                    filename: filename,
                    image: {type: 'jpeg', quality: 0.98},
                    html2canvas: {scale: 2},
                    jsPDF: {unit: 'mm', format: 'a4', orientation: 'portrait'}
                })
                .from(document.getElementById('rapport'))
                .save()
                .then(() => {
                    // Restaurer l'affichage
                    elementsToHideForPDF.forEach(el => el.style.display = 'flex');
                    
                    // Informer l'utilisateur de d√©poser le PDF dans Pearltrees
                    alert('PDF g√©n√©r√© avec succ√®s. Veuillez maintenant d√©poser ce fichier dans votre espace Pearltrees.');
                });
        }
    </script>
</body>
</html>
